---
alwaysApply: true
---

# 🚀 **Bidix v2.2 – AI 개발 가이드 (Full Rewrite)**

**Version:** v2.2
**Applies To:** Auction Engine v2.2, Simulation Generator v2.2, ProfitEngine v2.2
**Last Updated:** 2025-11-13
**Status:** 🔐 **SSOT Enforcement Active**

---

# 1. 🚨 **절대 원칙 (Golden Rules)**

Bidix v2.2의 모든 AI 코드 생성은 아래 규칙을 절대적으로 준수해야 한다.
이 원칙은 **컴포넌트 코드, 엔진 코드, 서버 액션, 서비스 레이어, 타입 정의 전체에 적용**된다.

---

## 1.1 파일명 규칙 (File Naming Convention) — **v2.2 업데이트**

| File Type           | Rule                | Example                                |
| ------------------- | ------------------- | -------------------------------------- |
| **.ts / .tsx**      | camelCase           | `auctionEngine.ts`, `reportHeader.tsx` |
| **문서(.md)**         | kebab-case          | `report-result.md`                     |
| **테스트코드(.test.ts)** | `camelCase.test.ts` | `auctionEngine.test.ts`                |

> ❗ v2.2에서는 **엔진/서비스/액션 파일명 절대 변경 금지**.
> 단 하나라도 어기면 전체 import chain이 깨지므로 AI는 절대 임의 변경 금지.

---

# 2. 🧱 **아키텍처 원칙 (Architecture Principles)**

v2.2의 전체 구조는 절대 변경 불가이며 AI는 아래 단방향 구조를 반드시 따라야 한다.

```
generators → engines → services → actions → UI(app)
```

### 변경 불가 규칙

* ❌ 상위 레이어를 하위 레이어에서 import 금지
* ❌ actions → engines 직접 호출 금지
* ❌ UI → engines 직접 호출 금지
* ❌ engines 내부에서 DB, fetch, random(), Date.now() 호출 금지

### 허용 규칙

* engines: **순수 함수**만 존재
* generators: 랜덤 시드·난이도 조건 분기
* services: DB 조합, 엔진 호출 orchestrator
* actions: Zod 검증 + service 호출
* UI(app): actions 호출 + props 전달만 수행

---

# 3. 🧪 **엔진 작성 규칙 (Engine Purity Rules)**

> **v2.2에서 가장 중요한 룰 — 엔진은 “순수 함수 집합”이어야 한다.**

### 엔진 금지사항

엔진 파일 내에서 다음 코드는 절대 금지:

```ts
import { createClient } from "@supabase/supabase-js"; // ❌
import { auth } from "@clerk/nextjs"; // ❌
console.log("debug") // ❌
crypto.randomUUID() // ❌
fetch(...) // ❌
Date.now() // ❌
```

### 엔진의 유일한 입력

* `Policy`
* `Property`
* `Rights`
* `Costs`
* `userBid`
* `CourtDocsNormalized`

### 엔진의 유일한 출력

* 각 Result DTO (`Valuation`, `Rights`, `Costs`, `Profit`, `AuctionAnalysisResult`)

---

# 4. 📐 **정책 기반 계산 (Policy-Driven Architecture)**

v2.2에서는 모든 계산은 **policy 오브젝트**로부터 파라미터를 받아서 실행해야 한다.

### 금지

* ❌ 숫자를 하드코딩하는 Magic Number
* ❌ 특정 난이도를 코드 내부 조건문으로 구현

### 필수

* 모든 계산은 아래 경로의 정책을 읽어야 한다:

```
/src/lib/policy/defaultPolicy.ts  
/src/lib/policy/difficultyPolicy.ts  
/src/lib/policy/valuationPolicy.ts (optional)
```

> v2.2에서 정책이 확대되었으므로 AI는 계산식을 작성할 때 반드시 정책 파라미터를 인자로 추가해야 한다.

---

# 5. 📚 **SSOT 우선주의 (Single Source of Truth)**

v2.2에서는 모든 타입/계산/데이터/리포트/엔진 문서는 아래 파일들을 절대 기준으로 삼아야 한다.

## SSOT 파일 목록 (필수 참조)

| 항목            | 경로                                          |
| ------------- | ------------------------------------------- |
| **타입 정의(전체)** | `/src/lib/types/*.ts`                       |
| **엔진 설계 문서**  | `/docs/engine/*.md`                         |
| **리포트 구조**    | `/docs/product/report-result.md (v2.2)`     |
| **UI 구조**     | `/docs/ui/component-architecture.md (v2.2)` |
| **빌드 계획**     | `/TODOv3.md (v2.2 Build Plan)`                |

> AI는 이 문서들에 정의되지 않은 개념·타입·필드를 절대 생성하면 안 된다.

---

# 6. 🧩 **총괄 지휘자 패턴 (Orchestrator Rules)**

### v2.2의 Orchestrator는 아래 2개만 존재

1. `simulationGenerator.ts`
2. `auctionEngine.ts`

> AI가 어떤 파일을 생성하거나 수정할 때, 다른 레이어(services/actions/UI)에서 엔진을 직접 호출하게 만들면 안 된다.

---

# 7. 🛰️ **서비스 레이어 규칙 (Services Layer)**

v2.2의 서비스 레이어는 **DB 통신 + 엔진 실행** 이 두 가지만 수행한다.

파일 위치는 반드시 다음과 같다:

```
/src/lib/services/simulationService.ts  
/src/lib/services/bidService.ts
```

서비스에서 할 일:

* Supabase read/write
* 정책 병합
* generator 호출
* auctionEngine 실행
* serialization

서비스에서 하면 안 되는 일:

* ❌ UI 반환형 만들기
* ❌ 입찰 성공/실패 판단
* ❌ 점수 계산
* ❌ 비즈니스 로직 추가 (전부 엔진이 함)

---

# 8. 🔐 **서버 액션 규칙 (Server Actions)**

서버 액션의 역할은 단 2가지:

1. **입력 검증 (Zod)**
2. **service 호출 후 결과 반환**

서버 액션에서 금지되는 것:

* ❌ DB 직접 호출
* ❌ 엔진 직접 호출
* ❌ 랜덤 데이터 생성
* ❌ UI용 DTO 생성
* ❌ 정책 변경

---

# 9. 🎨 **UI(app) 규칙**

### UI에서 허용되는 것

* Server Action 호출
* props 기반 렌더링
* shadcn/ui + tailwind

### UI에서 절대 금지되는 것

* ❌ Supabase 직접 호출
* ❌ 엔진 import
* ❌ 서비스 import
* ❌ 정책 import
* ❌ 비즈니스 계산

---

# 10. 🗂️ **참조 문서 경로 업데이트 (v2.2 기준)**

아래는 AI가 항상 따라야 하는 문서 참조 경로이다.

```text
@@src/index.ts
@@docs/product/report-result.md (v2.2)
@@docs/ui/component-architecture.md (v2.2)
@@docs/engine/auction-engine.md (v2.2)
@@docs/engine/valuation-engine.md (v2.2)
@@docs/engine/profit-engine.md (v2.2)
@@docs/engine/cost-engine.md (v2.2)
@@docs/engine/rights-engine.md (v2.2)
@@docs/engine/property-engine.md (v2.2)
@@TODOv3.md (v2.2 Build Plan)
```

---

# 11. 🛡️ **AI 코드 생성 시 금지 항목 요약**

### 절대 생성 금지

* ❌ 새로운 파일명
* ❌ 파일명 변경
* ❌ 새로운 타입 정의
* ❌ 새로운 엔진 생성
* ❌ 새로운 정책 필드
* ❌ import 체인 역행
* ❌ DB 접근 포함된 엔진
* ❌ Date.now(), fetch(), 랜덤 호출
* ❌ UI에서 엔진 호출

### 위반 시 상태

* **즉시 버그 발생 → v2.2 전체 체인 붕괴**
* AI는 이러한 변경을 “허용”해선 안 됨.

---

# 12. ✔️ **AI가 코드 생성할 때 따라야 할 Output Template**

아래 형식으로만 파일을 출력해야 한다:

```
/src/lib/engines/valuationEngine.ts
------------------------------------
(code...)

[END OF FILE]
```

절대 “추가 파일”, “경로 제안”, “파일명 변경” 하지 않는다.

---

# **END OF DOCUMENT — Bidix AI Development Guide v2.2**

---


