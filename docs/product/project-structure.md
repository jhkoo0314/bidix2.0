# ğŸ“ BIDIX v2.0 - lib í´ë” êµ¬ì¡° (Project Structure)

**Version:** 2.2  
**Last Updated:** 2025-01-30  
**Status:** âœ… **SSOT - Single Source of Truth**

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ êµ¬ì¡° ê°œìš”](#ì „ì²´-êµ¬ì¡°-ê°œìš”)
2. [ë””ë ‰í† ë¦¬ë³„ ìƒì„¸ ì„¤ëª…](#ë””ë ‰í† ë¦¬ë³„-ìƒì„¸-ì„¤ëª…)
3. [ì•„í‚¤í…ì²˜ ë ˆì´ì–´](#ì•„í‚¤í…ì²˜-ë ˆì´ì–´)
4. [ì˜ì¡´ì„± ê´€ê³„](#ì˜ì¡´ì„±-ê´€ê³„)
5. [íŒŒì¼ëª… ê·œì¹™](#íŒŒì¼ëª…-ê·œì¹™)

---

## ì „ì²´ êµ¬ì¡° ê°œìš”

```
lib/
â”œâ”€â”€ types/                    # ğŸ“Œ íƒ€ì… SSOT (Single Source of Truth)
â”‚   â”œâ”€â”€ property.ts
â”‚   â”œâ”€â”€ valuation.ts
â”‚   â”œâ”€â”€ rights.ts
â”‚   â”œâ”€â”€ cost.ts
â”‚   â”œâ”€â”€ profit.ts
â”‚   â”œâ”€â”€ courtdocs.ts
â”‚   â”œâ”€â”€ result.ts
â”‚   â””â”€â”€ index.ts             # Barrel export
â”‚
â”œâ”€â”€ policy/                   # ğŸ“‹ ì •ì±… ë ˆì´ì–´ (ê³„ì‚° ê·œì¹™ ë° ìƒìˆ˜)
â”‚   â”œâ”€â”€ policy.ts             # Policy ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ defaultpolicy.ts      # ê¸°ë³¸ ì •ì±…ê°’
â”‚   â”œâ”€â”€ difficultypolicy.ts   # ë‚œì´ë„ë³„ ì •ì±… (Easy/Normal/Hard)
â”‚   â”œâ”€â”€ rightspolicy.ts       # 18ì¢… ê¶Œë¦¬ ê¸°ì¤€ í…Œì´ë¸”
â”‚   â””â”€â”€ index.ts              # Barrel export
â”‚
â”œâ”€â”€ engines/                  # âš™ï¸ ê³„ì‚° ì—”ì§„ ë ˆì´ì–´ (Pure Function)
â”‚   â”œâ”€â”€ propertyengine.ts     # ë§¤ë¬¼ ì—”ì§„
â”‚   â”œâ”€â”€ valuationengine.ts   # ê°ì •ê°€ ì—”ì§„
â”‚   â”œâ”€â”€ courtdocslayer.ts     # ë²•ì›ë¬¸ì„œ ë ˆì´ì–´
â”‚   â”œâ”€â”€ rightsengine.ts      # ê¶Œë¦¬ ì—”ì§„
â”‚   â”œâ”€â”€ costengine.ts        # ë¹„ìš© ì—”ì§„
â”‚   â”œâ”€â”€ profitengine.ts      # ìˆ˜ìµ ì—”ì§„ (3/6/12ê°œì›”)
â”‚   â”œâ”€â”€ scoreengine.ts       # ì ìˆ˜ ì—”ì§„ (1000ì  ë§Œì )
â”‚   â””â”€â”€ auctionengine.ts     # ê²½ë§¤ ì—”ì§„ (Master Orchestrator)
â”‚
â”œâ”€â”€ generators/               # ğŸ² ëœë¤/ëª¨ì˜ ë°ì´í„° ìƒì„± ë ˆì´ì–´
â”‚   â”œâ”€â”€ datasetpresets.ts     # ì§€ì—­/í‰í˜•/ìœ í˜• í™•ë¥  í…Œì´ë¸”
â”‚   â”œâ”€â”€ generatorhelpers.ts   # ë‚œìˆ˜/ê°€ì¤‘ì¹˜/ID ìœ í‹¸
â”‚   â”œâ”€â”€ propertygenerator.ts  # ë§¤ë¬¼ ìƒì„±ê¸° (Â±5% ê°€ê²© ë³€ë™)
â”‚   â”œâ”€â”€ courtdocsmocker.ts   # ë²•ì›ë¬¸ì„œ ëª¨í‚¹
â”‚   â””â”€â”€ simulationgenerator.ts # ì‹œë®¬ë ˆì´ì…˜ ìƒì„±ê¸° (Master Generator)
â”‚
â”œâ”€â”€ services/                 # ğŸ”§ ì„œë¹„ìŠ¤ ë ˆì´ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°í•©)
â”‚   â”œâ”€â”€ __tests__/            # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”‚   â”‚   â””â”€â”€ simulationservice.test.ts
â”‚   â””â”€â”€ simulationservice.ts  # ì‹œë®¬ë ˆì´ì…˜ ì„œë¹„ìŠ¤ (DB + ì—”ì§„)
â”‚
â”œâ”€â”€ fixtures/                 # ğŸ“¦ ì‹¤ì œ JSON ìƒ˜í”Œ ë°ì´í„° (í…ŒìŠ¤íŠ¸/ë°ëª¨ìš©)
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ loadScenario.ts
â”‚   â””â”€â”€ scenarios/
â”‚       â”œâ”€â”€ apt-easy.json
â”‚       â”œâ”€â”€ officetel-normal.json
â”‚       â””â”€â”€ land-hard.json
â”‚
â”œâ”€â”€ supabase/                 # ğŸ—„ï¸ Supabase í´ë¼ì´ì–¸íŠ¸ (í™˜ê²½ë³„ ë¶„ë¦¬)
â”‚   â”œâ”€â”€ clerk-client.ts       # Client Componentìš© (useClerkSupabaseClient)
â”‚   â”œâ”€â”€ client.ts             # ê³µê°œ ë°ì´í„°ìš© (anon key)
â”‚   â”œâ”€â”€ server.ts             # Server Componentìš© (createClerkSupabaseClient)
â”‚   â””â”€â”€ service-role.ts      # ê´€ë¦¬ì ê¶Œí•œìš© (RLS ìš°íšŒ)
â”‚
â”œâ”€â”€ utils/                    # ğŸ› ï¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”œâ”€â”€ number.ts             # ìˆ«ì ê´€ë ¨ ìœ í‹¸ë¦¬í‹° (roundToK, formatCurrency ë“±)
â”‚   â”œâ”€â”€ outcome.ts            # ì…ì°° ê²°ê³¼ í¬ë§·íŒ… (formatOutcome)
â”‚   â””â”€â”€ score.ts              # ì ìˆ˜ ë“±ê¸‰ ë³€í™˜ (mapScoreToGrade)
â”‚
â”œâ”€â”€ utils.ts                  # ê³µí†µ ìœ í‹¸ë¦¬í‹° (cn í•¨ìˆ˜ ë“±)
â”œâ”€â”€ supabase.ts              # ë ˆê±°ì‹œ Supabase í´ë¼ì´ì–¸íŠ¸ (ì‚¬ìš© ì§€ì–‘)
â””â”€â”€ NAMING_CONVENTION.md      # íŒŒì¼ëª… ê·œì¹™ ë¬¸ì„œ
```

---

## ë””ë ‰í† ë¦¬ë³„ ìƒì„¸ ì„¤ëª…

### 1. `types/` - íƒ€ì… SSOT (Single Source of Truth)

**ì—­í• **: ëª¨ë“  TypeScript íƒ€ì… ì •ì˜ì˜ ë‹¨ì¼ ì¶œì²˜

**íŒŒì¼ ëª©ë¡**:

- `property.ts`: ë§¤ë¬¼ íƒ€ì… (`Property`, `PropertySeed` ë“±)
- `valuation.ts`: ê°ì •ê°€/í‰ê°€ íƒ€ì… (`Valuation`, `FMV` ë“±)
- `rights.ts`: ê¶Œë¦¬ íƒ€ì… (18ì¢… ê¶Œë¦¬ ì •ì˜)
- `cost.ts`: ë¹„ìš© íƒ€ì… (`Cost`, `AcquisitionCost`, `HoldingCost` ë“±)
- `profit.ts`: ìˆ˜ìµ íƒ€ì… (`Profit`, `ExitScenario` ë“±)
- `courtdocs.ts`: ë²•ì›ë¬¸ì„œ íƒ€ì… (`CourtDocs`, `CourtDocsNormalized` ë“±)
- `result.ts`: ê²°ê³¼ íƒ€ì… (`AuctionAnalysisResult`, `DifficultyMode` ë“±)
- `index.ts`: Barrel export (ëª¨ë“  íƒ€ì…ì„ í•œ ê³³ì—ì„œ export)

**íŠ¹ì§•**:

- âœ… **ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€**: íƒ€ì… ë³€ê²½ ì‹œ ì „ì²´ í”„ë¡œì íŠ¸ì— ì˜í–¥
- âœ… **Barrel export ì‚¬ìš©**: `@/lib/types`ë¡œ í†µì¼ëœ import
- âœ… **SSOT ì›ì¹™**: íƒ€ì…ì€ ì˜¤ì§ ì—¬ê¸°ì„œë§Œ ì •ì˜

---

### 2. `policy/` - ì •ì±… ë ˆì´ì–´

**ì—­í• **: ê³„ì‚° ë¡œì§ì— ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ê·œì¹™, ìƒìˆ˜, ê¸°ì¤€ê°’

**íŒŒì¼ ëª©ë¡**:

- `policy.ts`: `Policy` ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- `defaultpolicy.ts`: ê¸°ë³¸ ì •ì±…ê°’ (ê¸°ë³¸ ë‚œì´ë„, ê¸°ë³¸ ë¹„ìœ¨ ë“±)
- `difficultypolicy.ts`: ë‚œì´ë„ë³„ ì •ì±… (Easy/Normal/Hard)
- `rightspolicy.ts`: 18ì¢… ê¶Œë¦¬ ê¸°ì¤€ í…Œì´ë¸”
- `index.ts`: Barrel export

**íŠ¹ì§•**:

- âœ… **ì •ì±… ê¸°ë°˜ ê³„ì‚°**: ëª¨ë“  ì—”ì§„ì€ Policy ê°ì²´ë¥¼ ë°›ì•„ì„œ ê³„ì‚°
- âœ… **ë‚œì´ë„ë³„ ë¶„ë¦¬**: Easy/Normal/Hardë³„ë¡œ ë‹¤ë¥¸ ì •ì±… ì ìš©
- âœ… **Magic Number ê¸ˆì§€**: í•˜ë“œì½”ë”©ëœ ìˆ«ì ì—†ì´ ì •ì±…ì—ì„œ ì½ì–´ì˜´

---

### 3. `engines/` - ê³„ì‚° ì—”ì§„ ë ˆì´ì–´

**ì—­í• **: ìˆœìˆ˜ ê³„ì‚° í•¨ìˆ˜ (Pure Function) - ì™¸ë¶€ I/O ê¸ˆì§€

**íŒŒì¼ ëª©ë¡**:

- `propertyengine.ts`: PropertySeed â†’ Property ì •ê·œí™”
- `valuationengine.ts`: FMV, minBid, ExitPrice ê³„ì‚°
- `courtdocslayer.ts`: CourtDocs â†’ CourtDocsNormalized ì •ê·œí™”
- `rightsengine.ts`: ê¶Œë¦¬ ë¶„ì„, ëª…ë„ë¹„ìš© ê³„ì‚°
- `costengine.ts`: ì·¨ë“ë¹„ìš©, ë³´ìœ ë¹„ìš© ê³„ì‚°
- `profitengine.ts`: 3/6/12ê°œì›” ìˆ˜ìµ ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
- `scoreengine.ts`: ì ìˆ˜ ê³„ì‚° (1000ì  ë§Œì )
- `auctionengine.ts`: **Master Orchestrator** - ëª¨ë“  ì—”ì§„ì„ ì¡°í•©í•˜ì—¬ ìµœì¢… ê²°ê³¼ ìƒì„±

**íŠ¹ì§•**:

- âœ… **ìˆœìˆ˜ í•¨ìˆ˜**: DB, fetch, random(), Date.now() ê¸ˆì§€
- âœ… **Policy ê¸°ë°˜**: ëª¨ë“  ê³„ì‚°ì€ Policy ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ
- âœ… **íƒ€ì… ê¸°ë°˜**: ëª¨ë“  ì…ì¶œë ¥ì€ `lib/types/`ì—ì„œ ì •ì˜ëœ íƒ€ì… ì‚¬ìš©
- âœ… **ë‹¨ë°©í–¥ ì˜ì¡´ì„±**: enginesëŠ” types, policyë§Œ import ê°€ëŠ¥

**ê¸ˆì§€ì‚¬í•­**:

- âŒ `import { createClient } from "@supabase/supabase-js"`
- âŒ `import { auth } from "@clerk/nextjs"`
- âŒ `console.log("debug")` (í”„ë¡œë•ì…˜ ì½”ë“œ)
- âŒ `crypto.randomUUID()`
- âŒ `fetch(...)`
- âŒ `Date.now()`

---

### 4. `generators/` - ë°ì´í„° ìƒì„± ë ˆì´ì–´

**ì—­í• **: ëœë¤ ë°ì´í„° ë° ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±

**íŒŒì¼ ëª©ë¡**:

- `datasetpresets.ts`: ì§€ì—­/í‰í˜•/ìœ í˜• í™•ë¥  í…Œì´ë¸”
- `generatorhelpers.ts`: ë‚œìˆ˜ ìƒì„±, ê°€ì¤‘ì¹˜ ì„ íƒ, ID ìƒì„± ìœ í‹¸
- `propertygenerator.ts`: ë§¤ë¬¼ ìƒì„±ê¸° (Â±5% ê°€ê²© ë³€ë™)
- `courtdocsmocker.ts`: ë²•ì›ë¬¸ì„œ ëª¨í‚¹ (ëœë¤ ìƒì„±)
- `simulationgenerator.ts`: **Master Generator** - ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±

**íŠ¹ì§•**:

- âœ… **ì™„ì „ ìì²´ ìƒì„±**: ì™¸ë¶€ API ì‚¬ìš© ì•ˆ í•¨
- âœ… **ëœë¤ ì‹œë“œ ê¸°ë°˜**: ì¬í˜„ ê°€ëŠ¥í•œ ëœë¤ ë°ì´í„° ìƒì„±
- âœ… **ë‚œì´ë„ë³„ ë¶„ê¸°**: Easy/Normal/Hardì— ë”°ë¼ ë‹¤ë¥¸ ë°ì´í„° ìƒì„±

---

### 5. `services/` - ì„œë¹„ìŠ¤ ë ˆì´ì–´

**ì—­í• **: DB í†µì‹  + ì—”ì§„ ì‹¤í–‰ ì¡°í•©

**íŒŒì¼ ëª©ë¡**:

- `simulationservice.ts`: ì‹œë®¬ë ˆì´ì…˜ ì„œë¹„ìŠ¤
  - Supabase read/write
  - ì •ì±… ë³‘í•©
  - generator í˜¸ì¶œ
  - auctionEngine ì‹¤í–‰
  - serialization
- `__tests__/simulationservice.test.ts`: ì‹œë®¬ë ˆì´ì…˜ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

**íŠ¹ì§•**:

- âœ… **DB í†µì‹ **: Supabase í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
- âœ… **ì—”ì§„ ì¡°í•©**: ì—¬ëŸ¬ ì—”ì§„ì„ ì¡°í•©í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
- âœ… **ì •ì±… ë³‘í•©**: defaultPolicy + difficultyPolicy ë³‘í•©
- âœ… **í…ŒìŠ¤íŠ¸ í¬í•¨**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ íŒŒì¼ í¬í•¨
- âŒ **UI ë°˜í™˜í˜• ê¸ˆì§€**: ì—”ì§„ íƒ€ì… ê·¸ëŒ€ë¡œ ë°˜í™˜

---

### 6. `fixtures/` - í…ŒìŠ¤íŠ¸ ë°ì´í„°

**ì—­í• **: ì‹¤ì œ JSON ìƒ˜í”Œ ë°ì´í„° (í…ŒìŠ¤íŠ¸/ë°ëª¨ìš©)

**íŒŒì¼ ëª©ë¡**:

- `index.ts`: Barrel export
- `loadScenario.ts`: ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ìœ í‹¸
- `scenarios/`: JSON ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼
  - `apt-easy.json`: ì•„íŒŒíŠ¸ ì‰¬ìš´ ë‚œì´ë„
  - `officetel-normal.json`: ì˜¤í”¼ìŠ¤í…” ë³´í†µ ë‚œì´ë„
  - `land-hard.json`: í† ì§€ ì–´ë ¤ìš´ ë‚œì´ë„

**íŠ¹ì§•**:

- âœ… **ì‹¤ì œ ë°ì´í„°**: ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°
- âœ… **ë‚œì´ë„ë³„ ìƒ˜í”Œ**: Easy/Normal/Hard ìƒ˜í”Œ ì œê³µ

---

### 7. `supabase/` - Supabase í´ë¼ì´ì–¸íŠ¸

**ì—­í• **: í™˜ê²½ë³„ Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

**íŒŒì¼ ëª©ë¡**:

- `clerk-client.ts`: Client Componentìš© (`useClerkSupabaseClient` hook)
- `client.ts`: ê³µê°œ ë°ì´í„°ìš© (anon keyë§Œ ì‚¬ìš©)
- `server.ts`: Server Componentìš© (`createClerkSupabaseClient`)
- `service-role.ts`: ê´€ë¦¬ì ê¶Œí•œìš© (RLS ìš°íšŒ, ì„œë²„ ì‚¬ì´ë“œ ì „ìš©)

**íŠ¹ì§•**:

- âœ… **í™˜ê²½ë³„ ë¶„ë¦¬**: Client/Server/Service Role ë¶„ë¦¬
- âœ… **Clerk í†µí•©**: Clerk í† í°ì„ ì‚¬ìš©í•œ ì¸ì¦
- âœ… **RLS ì§€ì›**: Row Level Security ì •ì±… ì ìš©

---

### 8. `utils/` - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

**ì—­í• **: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

**íŒŒì¼ ëª©ë¡**:

- `number.ts`: ìˆ«ì ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
  - `roundToK(value: number)`: ì²œ ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼
  - `seedBasedRandom(seed: string)`: ì‹œë“œ ê¸°ë°˜ ëœë¤ ê°’ ìƒì„±
  - `seedBasedRandomInt(seed, min, max)`: ì‹œë“œ ê¸°ë°˜ ì •ìˆ˜ ë‚œìˆ˜ ìƒì„±
  - `formatPercentage(value, decimals)`: ë°±ë¶„ìœ¨ í¬ë§·íŒ…
  - `formatCurrency(value)`: ê¸ˆì•¡ í¬ë§·íŒ…
- `outcome.ts`: ì…ì°° ê²°ê³¼ í¬ë§·íŒ…
  - `formatOutcome(outcome)`: ì…ì°° ê²°ê³¼ë¥¼ UI í‘œì‹œìš©ìœ¼ë¡œ í¬ë§·íŒ… (ë¼ë²¨, ì•„ì´ì½˜, ìƒ‰ìƒ)
- `score.ts`: ì ìˆ˜ ë“±ê¸‰ ë³€í™˜
  - `mapScoreToGrade(score)`: ì ìˆ˜ë¥¼ ë“±ê¸‰(S/A/B/C/D)ìœ¼ë¡œ ë³€í™˜

**íŠ¹ì§•**:

- âœ… **ë„ë©”ì¸ íŠ¹í™”**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— íŠ¹í™”ëœ ìœ í‹¸ë¦¬í‹°
- âœ… **ìˆœìˆ˜ í•¨ìˆ˜**: ë¶€ìˆ˜ íš¨ê³¼ ì—†ìŒ
- âœ… **UI ì§€ì›**: UI í‘œì‹œìš© í¬ë§·íŒ… í•¨ìˆ˜ í¬í•¨

---

### 9. ë£¨íŠ¸ ë ˆë²¨ íŒŒì¼

**íŒŒì¼ ëª©ë¡**:

- `utils.ts`: ê³µí†µ ìœ í‹¸ë¦¬í‹° (`cn` í•¨ìˆ˜ - Tailwind í´ë˜ìŠ¤ ë³‘í•©)
- `supabase.ts`: ë ˆê±°ì‹œ Supabase í´ë¼ì´ì–¸íŠ¸ (ì‚¬ìš© ì§€ì–‘, `supabase/` í´ë” ì‚¬ìš© ê¶Œì¥)
- `NAMING_CONVENTION.md`: íŒŒì¼ëª… ê·œì¹™ ë¬¸ì„œ

---

## ì•„í‚¤í…ì²˜ ë ˆì´ì–´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Layer (app/, components/)                                â”‚
â”‚ - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤                                          â”‚
â”‚ - Server Actionsë§Œ í˜¸ì¶œ                                      â”‚
â”‚ - ì—”ì§„ ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Actions (app/action/)                                  â”‚
â”‚ - ì¸ì¦ í™•ì¸ (Clerk auth())                                   â”‚
â”‚ - ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ (Zod)                                     â”‚
â”‚ - Service Layer í˜¸ì¶œ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Layer (lib/services/)                                â”‚
â”‚ - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°í•©                                         â”‚
â”‚ - DB í†µì‹  (Supabase)                                         â”‚
â”‚ - ì—¬ëŸ¬ ì—”ì§„ ì¡°í•© í˜¸ì¶œ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Engine Layer (lib/engines/)                                  â”‚
â”‚ - ìˆœìˆ˜ ê³„ì‚° í•¨ìˆ˜ (Pure Function)                             â”‚
â”‚ - ì™¸ë¶€ I/O ê¸ˆì§€                                              â”‚
â”‚ - Policy ê¸°ë°˜ ê³„ì‚°                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generator Layer (lib/generators/)                            â”‚
â”‚ - ëœë¤ ë°ì´í„° ìƒì„±                                           â”‚
â”‚ - ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±                                              â”‚
â”‚ - ì™¸ë¶€ API ì‚¬ìš© ì•ˆ í•¨ (ì™„ì „ ìì²´ ìƒì„±)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Policy Layer (lib/policy/)                                   â”‚
â”‚ - ê³„ì‚°ì— ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ê·œì¹™ê³¼ ìƒìˆ˜                           â”‚
â”‚ - ë‚œì´ë„ë³„ ì •ì±…                                              â”‚
â”‚ - ê¶Œë¦¬ ê¸°ì¤€ í…Œì´ë¸”                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type Layer (lib/types/)                                      â”‚
â”‚ - ëª¨ë“  TypeScript íƒ€ì…ì˜ SSOT                                â”‚
â”‚ - Barrel export (index.ts)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì˜ì¡´ì„± ê´€ê³„

### ë‹¨ë°©í–¥ ì˜ì¡´ì„± ì›ì¹™

```
generators â†’ engines â†’ services â†’ actions â†’ UI
```

**ê·œì¹™**:

- âœ… í•˜ìœ„ ë ˆì´ì–´ëŠ” ìƒìœ„ ë ˆì´ì–´ë¥¼ importí•  ìˆ˜ ì—†ìŒ
- âœ… UIëŠ” engines, services ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€
- âœ… enginesëŠ” DB, fetch, random() í˜¸ì¶œ ê¸ˆì§€
- âœ… ëª¨ë“  íƒ€ì…ì€ `lib/types/`ì—ì„œë§Œ import

### í—ˆìš©ë˜ëŠ” Import

```typescript
// âœ… enginesì—ì„œ types, policy import
import { Property, Valuation } from "@/lib/types";
import { Policy } from "@/lib/policy/policy";

// âœ… servicesì—ì„œ engines, types, policy import
import { AuctionEngine } from "@/lib/engines/auctionengine";
import { PropertySeed } from "@/lib/types";

// âœ… generatorsì—ì„œ types, engines import
import { PropertySeed } from "@/lib/types";
import { normalizeCourtDocs } from "@/lib/engines/courtdocslayer";
```

### ê¸ˆì§€ë˜ëŠ” Import

```typescript
// âŒ enginesì—ì„œ services import
import { SimulationService } from "@/lib/services/simulationservice";

// âŒ enginesì—ì„œ UI import
import { PropertyCard } from "@/app/components/PropertyCard";

// âŒ UIì—ì„œ engines ì§ì ‘ import
import { AuctionEngine } from "@/lib/engines/auctionengine";
```

---

## íŒŒì¼ëª… ê·œì¹™

### ê¸°ë³¸ ì›ì¹™

**ëª¨ë“  íŒŒì¼ëª…ì€ ì†Œë¬¸ìë¡œ í†µì¼í•©ë‹ˆë‹¤.**

### ë””ë ‰í† ë¦¬ë³„ ê·œì¹™

| ë””ë ‰í† ë¦¬      | ê·œì¹™                     | ì˜ˆì‹œ                     |
| ------------- | ------------------------ | ------------------------ |
| `engines/`    | ì†Œë¬¸ì                   | `auctionengine.ts`       |
| `generators/` | ì†Œë¬¸ì                   | `simulationgenerator.ts` |
| `types/`      | ì†Œë¬¸ì                   | `property.ts`            |
| `services/`   | ì†Œë¬¸ì                   | `simulationservice.ts`   |
| `policy/`     | ì†Œë¬¸ì                   | `defaultpolicy.ts`       |
| `utils/`      | ì†Œë¬¸ì                   | `number.ts`              |
| `supabase/`   | ì†Œë¬¸ì (kebab-case í—ˆìš©) | `clerk-client.ts`        |

### Import ì‹œ ì£¼ì˜ì‚¬í•­

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ (ëŒ€ë¬¸ì ì‚¬ìš©)
import { generateSimulationScenario } from "@/lib/generators/Simulationgenerator";
import { Property } from "@/lib/types/Property";

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ (ì†Œë¬¸ì ì‚¬ìš©)
import { generateSimulationScenario } from "@/lib/generators/simulationgenerator";
import { Property } from "@/lib/types/property";
```

**ìì„¸í•œ ë‚´ìš©**: `lib/NAMING_CONVENTION.md` ì°¸ê³ 

---

## í•µì‹¬ ì›ì¹™ ìš”ì•½

### 1. SSOT (Single Source of Truth)

- **íƒ€ì…**: `lib/types/` (ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€)
- **ì •ì±…**: `lib/policy/` (ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€)
- **ì—”ì§„**: `lib/engines/` (ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€)

### 2. ë‹¨ë°©í–¥ ì˜ì¡´ì„±

- `UI â†’ Server Actions â†’ Services â†’ Engines â†’ Policy/Types`
- í•˜ìœ„ ë ˆì´ì–´ëŠ” ìƒìœ„ ë ˆì´ì–´ë¥¼ importí•  ìˆ˜ ì—†ìŒ

### 3. ì—”ì§„ì˜ ìˆœìˆ˜ì„±

- ì™¸ë¶€ I/O ê¸ˆì§€ (DB, API, ëœë¤ ë“±)
- ëª¨ë“  ì˜ì¡´ì„±ì€ íŒŒë¼ë¯¸í„°ë¡œ ì£¼ì…
- Policy ê¸°ë°˜ ê³„ì‚°

### 4. íŒŒì¼ëª… í†µì¼

- ëª¨ë“  íŒŒì¼ëª…ì€ ì†Œë¬¸ì
- Import ê²½ë¡œëŠ” ì‹¤ì œ íŒŒì¼ëª…ê³¼ ì •í™•íˆ ì¼ì¹˜

---

## ê´€ë ¨ ë¬¸ì„œ

- **í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡°**: `docs/index.ts`
- **ë¹Œë“œ ê³„íš**: `docs/product/todov3.md`
- **API ëª…ì„¸**: `docs/engine/api-contracts.md`
- **íƒ€ì… ì •ì˜**: `docs/domain/` + `lib/types/`
- **ì—”ì§„ ëª…ì„¸**: `docs/engine/`
- **íŒŒì¼ëª… ê·œì¹™**: `lib/NAMING_CONVENTION.md`

---

**ì´ ë¬¸ì„œëŠ” `lib/` í´ë” êµ¬ì¡°ì˜ SSOTì…ë‹ˆë‹¤. êµ¬ì¡°ê°€ ë³€ê²½ë˜ë©´ ë°˜ë“œì‹œ ì´ ë¬¸ì„œë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.**
